<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.17.7"/><title data-react-helmet="true">Server Side NodeJs</title><link as="script" rel="preload" href="/component---gatsby-theme-mdx-deck-src-templates-deck-js-52381b3c74ef8f0a1d31.js"/><link as="script" rel="preload" href="/commons-cb11f4ecc482359b7fd0.js"/><link as="script" rel="preload" href="/app-3fe65d65bb04262185f8.js"/><link as="script" rel="preload" href="/webpack-runtime-624e0cc4eb6b8a828713.js"/><link as="fetch" rel="preload" href="/page-data/print/page-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="13j5fvw">body{margin:0;}</style><style data-emotion-css="bdfrlc">.css-bdfrlc{width:100vw;height:100vh;}.css-bdfrlc *{box-sizing:border-box;}</style><div class="css-bdfrlc"><div style="outline:none;height:100%" tabindex="-1" role="group"><style data-emotion-css="gxvojt">.css-gxvojt{box-sizing:border-box;width:100%;height:100vh;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;overflow:hidden;position:relative;color:var(--theme-ui-colors-text,#9CDCFE);background-color:var(--theme-ui-colors-background,#1E1E1E);font-family:system-ui,sans-serif;font-size:20px;}@media screen and (min-width:40em){.css-gxvojt{font-size:24px;}}@media screen and (min-width:52em){.css-gxvojt{font-size:32px;}}@media screen and (min-width:64em){.css-gxvojt{font-size:48px;}}</style><div class="css-gxvojt"><style data-emotion-css="1djqpdg">.css-1djqpdg{font-family:inherit;line-height:1.125;font-weight:700;}</style><h1 class="css-1djqpdg">Server Side NodeJs</h1><h2 class="css-1djqpdg">By Elias Hussary</h2></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Agenda</h2><style data-emotion-css="1uk1gs8">.css-1uk1gs8{margin:0;}</style><ol class="css-1uk1gs8"><li class="css-0">History of Node</li><li class="css-0">Strengths &amp; Weaknesses</li><li class="css-0">Tour of Server Side Node<ul class="css-1uk1gs8"><li class="css-0">stdlib http</li><li class="css-0">express</li><li class="css-0">async patterns</li></ul></li><li class="css-0">Fullstack Javascript (SSR)</li><li class="css-0">Demo</li><li class="css-0">Scaling Node</li><li class="css-0">Questions</li></ol></div><div class="css-gxvojt"><h2 class="css-1djqpdg">History of Server Side Javascript &amp; Node</h2><ul class="css-1uk1gs8"><li class="css-0">Node was introduced in 2011 by Ryan Dahl</li><li class="css-0">Built ontop of Google&#x27;s V8 runtime (also offered on Chakra)</li><li class="css-0">C++ bindings makeup the greater part of the NodeJS stdlib</li><li class="css-0">Allows for general purpose programming</li><li class="css-0">Great for I/O heavy applications</li></ul></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Strengths &amp; Weaknesses of NodeJs</h2></div><div class="css-gxvojt"><h3 class="css-1djqpdg">Weaknesses</h3><ul class="css-1uk1gs8"><li class="css-0">Single threaded<!-- -->*<ul class="css-1uk1gs8"><li class="css-0">*<!-- -->applications must be designed to operate in clusters</li></ul></li><li class="css-0">Slower than most other languages</li><li class="css-0">Javascript is dynamically typed; <ul class="css-1uk1gs8"><li class="css-0">more prone to sloppy code and trivial errors</li><li class="css-0">use typescript</li></ul></li><li class="css-0">stdlib lacks in many ways, encourages the use of NPM</li><li class="css-0">NPM<ul class="css-1uk1gs8"><li class="css-0">code from these packages are sometimes questionable</li><li class="css-0">huge attack vector</li></ul></li></ul></div><div class="css-gxvojt"><h3 class="css-1djqpdg">Strengths</h3><ul class="css-1uk1gs8"><li class="css-0">Asynchronous by nature; <ul class="css-1uk1gs8"><li class="css-0">great for I/O driven applications (servers)</li></ul></li><li class="css-0">Full stack web applications now in Javascript<ul class="css-1uk1gs8"><li class="css-0">great for MVPs and prototyping</li><li class="css-0">increases productivity, less context switching for devs</li><li class="css-0">faster dev time promoting iterative feedback loops early</li></ul></li><li class="css-0">Thriving package ecosystem via Node Package Manager (npm)</li><li class="css-0">Allows for Server Side Rendered SPA&#x27;s</li><li class="css-0">NPM<ul class="css-1uk1gs8"><li class="css-0">there is a module for everything</li></ul></li></ul></div><div class="css-gxvojt"><h1 class="css-1djqpdg">A Tour of Node</h1></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><style data-emotion-css="oedec6">.css-oedec6{color:#9CDCFE;background-color:#1E1E1E;}.css-oedec6 .token-prolog{color:rgb(0,0,128);}.css-oedec6 .token-comment{color:rgb(106,153,85);}.css-oedec6 .token-builtin,.css-oedec6 .token-changed,.css-oedec6 .token-keyword{color:rgb(86,156,214);}.css-oedec6 .token-number,.css-oedec6 .token-inserted{color:rgb(181,206,168);}.css-oedec6 .token-constant{color:rgb(100,102,149);}.css-oedec6 .token-attr-name,.css-oedec6 .token-variable{color:rgb(156,220,254);}.css-oedec6 .token-deleted,.css-oedec6 .token-string,.css-oedec6 .token-attr-value{color:rgb(206,145,120);}.css-oedec6 .token-selector{color:rgb(215,186,125);}.css-oedec6 .token-tag{color:rgb(86,156,214);}.css-oedec6 .token-punctuation,.css-oedec6 .token-operator{color:rgb(212,212,212);}.css-oedec6 .token-punctuation{color:#808080;}.css-oedec6 .token-function{color:rgb(220,220,170);}.css-oedec6 .token-class-name{color:rgb(78,201,176);}.css-oedec6 .token-char{color:rgb(209,105,105);}</style><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><style data-emotion-css="xbe36b">.css-xbe36b{color:#9CDCFE;background-color:#1E1E1E;}</style><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> http </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;http&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-string">&quot;localhost&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parseInt</span><span class="token-punctuation">(</span><span class="token-operator">&lt;</span><span class="token-builtin">string</span><span class="token-operator">&gt;</span><span class="token-plain">process</span><span class="token-punctuation">.</span><span class="token-property-access">env</span><span class="token-punctuation">.</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">||</span><span class="token-plain"> </span><span class="token-number">3000</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">requestListener</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">  </span><span class="token-parameter">req</span><span class="token-punctuation">:</span><span class="token-parameter"> http</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">IncomingMessage</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-parameter">  res</span><span class="token-punctuation">:</span><span class="token-parameter"> http</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">ServerResponse</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-punctuation">)</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-keyword">void</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-string">&quot;&gt; Request at:&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> req</span><span class="token-punctuation">.</span><span class="token-property-access">url</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">  res</span><span class="token-punctuation">.</span><span class="token-property-access">statusCode</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-number">200</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  res</span><span class="token-punctuation">.</span><span class="token-method">setHeader</span><span class="token-punctuation">(</span><span class="token-string">&quot;Content-Type&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-string">&quot;application/json&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">  res</span><span class="token-punctuation">.</span><span class="token-method">end</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">    </span><span class="token-known-class-name">JSON</span><span class="token-punctuation">.</span><span class="token-method">stringify</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">      message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Hello World!&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">  </span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-keyword">const</span><span class="token-plain"> server </span><span class="token-operator">=</span><span class="token-plain"> http</span><span class="token-punctuation">.</span><span class="token-method">createServer</span><span class="token-punctuation">(</span><span class="token-plain">requestListener</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">server</span><span class="token-punctuation">.</span><span class="token-method">listen</span><span class="token-punctuation">(</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-string">&quot;&gt; Listening on port %s:%s&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><style data-emotion-css="1q54swq">.css-1q54swq{position:absolute;top:0;width:100%;margin:0;padding:1em 0;text-align:center;background-color:#1E1E1E;color:#9CDCFE;}</style><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">stdlib http server</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parseInt</span><span class="token-punctuation">(</span><span class="token-operator">&lt;</span><span class="token-builtin">string</span><span class="token-operator">&gt;</span><span class="token-plain">process</span><span class="token-punctuation">.</span><span class="token-property-access">env</span><span class="token-punctuation">.</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">||</span><span class="token-plain"> </span><span class="token-number">3000</span><span class="token-punctuation">;</span></div></div><div></div></code></pre></div></div></div></div></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Adding middleware</h2></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> http </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;http&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;./types&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">class</span><span class="token-plain"> </span><span class="token-class-name">App</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">  </span><span class="token-keyword">private</span><span class="token-plain"> stack</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">  </span><span class="token-function-variable">use</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">handler</span><span class="token-punctuation">:</span><span class="token-parameter"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">    </span><span class="token-keyword">this</span><span class="token-punctuation">.</span><span class="token-property-access">stack</span><span class="token-punctuation">.</span><span class="token-method">push</span><span class="token-punctuation">(</span><span class="token-plain">handler</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-keyword">this</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  handle</span><span class="token-punctuation">:</span><span class="token-plain"> http</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">RequestListener</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> context </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">      req</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">      res</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">    </span><span class="token-keyword">let</span><span class="token-plain"> idx </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-operator">-</span><span class="token-number">1</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> stack </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">this</span><span class="token-punctuation">.</span><span class="token-property-access">stack</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">    </span><span class="token-function">next</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">    </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">next</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">      idx </span><span class="token-operator">+=</span><span class="token-plain"> </span><span class="token-number">1</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">      </span><span class="token-keyword">const</span><span class="token-plain"> handler </span><span class="token-operator">=</span><span class="token-plain"> stack</span><span class="token-punctuation">[</span><span class="token-plain">idx</span><span class="token-punctuation">]</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">      </span><span class="token-function">handler</span><span class="token-punctuation">(</span><span class="token-plain">context</span><span class="token-punctuation">,</span><span class="token-plain"> next</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-punctuation">}</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">middleware app</span></h4><style data-emotion-css="fs2d1k">.css-fs2d1k{position:absolute;bottom:0;width:calc(100% - 2em);box-sizing:border-box;margin:0.3em 1em;padding:0.5em;background:rgba(2,2,2,0.9);text-align:center;color:#d6deeb;background-color:rgba(10,10,10,0.9);}</style><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">./app.ts</span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  handle</span><span class="token-punctuation">:</span><span class="token-plain"> http</span><span class="token-punctuation">.</span><span class="token-maybe-class-name">RequestListener</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div></div></code></pre></div></div></div></div></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> http </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;http&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-maybe-class-name">App</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;./app&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-plain"> </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;./types&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-string">&quot;localhost&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parseInt</span><span class="token-punctuation">(</span><span class="token-operator">&lt;</span><span class="token-builtin">string</span><span class="token-operator">&gt;</span><span class="token-plain">process</span><span class="token-punctuation">.</span><span class="token-property-access">env</span><span class="token-punctuation">.</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">||</span><span class="token-plain"> </span><span class="token-number">3000</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-keyword">const</span><span class="token-plain"> app </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">new</span><span class="token-plain"> </span><span class="token-class-name">App</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-keyword">const</span><span class="token-plain"> logIncomingRequest</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">ctx</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-string">&quot;&gt; Request at:&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> ctx</span><span class="token-punctuation">.</span><span class="token-property-access">req</span><span class="token-punctuation">.</span><span class="token-property-access">url</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">  </span><span class="token-function">next</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-keyword">const</span><span class="token-plain"> setJsonContentType</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">ctx</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">  ctx</span><span class="token-punctuation">.</span><span class="token-property-access">res</span><span class="token-punctuation">.</span><span class="token-method">setHeader</span><span class="token-punctuation">(</span><span class="token-string">&quot;Content-Type&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-string">&quot;application/json&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">  </span><span class="token-function">next</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-keyword">const</span><span class="token-plain"> sayHello</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-maybe-class-name">MiddlewareHandler</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">ctx</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">  ctx</span><span class="token-punctuation">.</span><span class="token-property-access">res</span><span class="token-punctuation">.</span><span class="token-property-access">statusCode</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-number">200</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">  ctx</span><span class="token-punctuation">.</span><span class="token-property-access">res</span><span class="token-punctuation">.</span><span class="token-method">end</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">    </span><span class="token-known-class-name">JSON</span><span class="token-punctuation">.</span><span class="token-method">stringify</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">      message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Hello World&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">  </span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-punctuation">}</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">app</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-30"><span class="token-plain">  </span><span class="token-punctuation">.</span><span class="token-method">use</span><span class="token-punctuation">(</span><span class="token-plain">logIncomingRequest</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">  </span><span class="token-punctuation">.</span><span class="token-method">use</span><span class="token-punctuation">(</span><span class="token-plain">setJsonContentType</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">  </span><span class="token-punctuation">.</span><span class="token-method">use</span><span class="token-punctuation">(</span><span class="token-plain">sayHello</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-33"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-keyword">const</span><span class="token-plain"> server </span><span class="token-operator">=</span><span class="token-plain"> http</span><span class="token-punctuation">.</span><span class="token-method">createServer</span><span class="token-punctuation">(</span><span class="token-plain">app</span><span class="token-punctuation">.</span><span class="token-property-access">handle</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-35"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-36"><span class="token-plain">server</span><span class="token-punctuation">.</span><span class="token-method">listen</span><span class="token-punctuation">(</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-37"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-string">&quot;&gt; Listening on port %s:%s&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-38"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">stdlib http server with middleware</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">./index.ts</span></p></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Using Express</h1></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> express </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;express&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">import</span><span class="token-plain"> bodyParser </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;body-parser&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parseInt</span><span class="token-punctuation">(</span><span class="token-operator">&lt;</span><span class="token-plain">string</span><span class="token-operator">&gt;</span><span class="token-plain">process</span><span class="token-punctuation">.</span><span class="token-property-access">env</span><span class="token-punctuation">.</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">||</span><span class="token-plain"> </span><span class="token-number">3000</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-string">&quot;localhost&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-keyword">const</span><span class="token-plain"> app </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">express</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">app</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">  </span><span class="token-punctuation">.</span><span class="token-method">use</span><span class="token-punctuation">(</span><span class="token-plain">bodyParser</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">  </span><span class="token-punctuation">.</span><span class="token-method">get</span><span class="token-punctuation">(</span><span class="token-string">&quot;/&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">    res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">200</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">      message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-string">&quot;Go Away!&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">  </span><span class="token-punctuation">.</span><span class="token-method">get</span><span class="token-punctuation">(</span><span class="token-string">&quot;/hello/:name&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> name </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> req</span><span class="token-punctuation">.</span><span class="token-property-access">params</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">    res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">200</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">      message</span><span class="token-punctuation">:</span><span class="token-plain"> </span><span class="token-template-punctuation">`</span><span class="token-string">Hello </span><span class="token-interpolation-punctuation">${</span><span class="token-interpolation">name</span><span class="token-interpolation-punctuation">}</span><span class="token-template-punctuation">`</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">app</span><span class="token-punctuation">.</span><span class="token-method">listen</span><span class="token-punctuation">(</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">HOSTNAME</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-string">&quot;&gt; Listening on port %s&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">express hello world</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-constant">PORT</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">parseInt</span><span class="token-punctuation">(</span><span class="token-operator">&lt;</span><span class="token-plain">string</span><span class="token-operator">&gt;</span><span class="token-plain">process</span><span class="token-punctuation">.</span><span class="token-property-access">env</span><span class="token-punctuation">.</span><span class="token-constant">PORT</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">||</span><span class="token-plain"> </span><span class="token-number">3000</span><span class="token-punctuation">;</span></div></div><div></div></code></pre></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Async Patterns</h1></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> callbacks </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;../services/weatherApi&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">  getLngLatFromIPAddr</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">  getCityFromLngLat</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">  getForecast</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">  transformForecast</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> callbacks</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">  res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">500</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherCallbacks</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> ipAddr </span><span class="token-operator">=</span><span class="token-plain"> req</span><span class="token-punctuation">.</span><span class="token-property-access">connection</span><span class="token-punctuation">.</span><span class="token-property-access">remoteAddress</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">  </span><span class="token-function">getLngLatFromIPAddr</span><span class="token-punctuation">(</span><span class="token-plain">ipAddr</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> lngLat</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">      </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">    </span><span class="token-function">getCityFromLngLat</span><span class="token-punctuation">(</span><span class="token-plain">lngLat</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> city</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">      </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">        </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">      </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">      </span><span class="token-function">getForecast</span><span class="token-punctuation">(</span><span class="token-plain">city</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> forecast</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">        </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">          </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-plain">        </span><span class="token-function">transformForecast</span><span class="token-punctuation">(</span><span class="token-plain">forecast</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> transformedForecast</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">          </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-30"><span class="token-plain">          </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">          </span><span class="token-keyword">return</span><span class="token-plain"> res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">200</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-plain">transformedForecast</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-33"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-plain">      </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-35"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-36"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-37"><span class="token-punctuation">}</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">Callbacks</span></h4><p class="cs-subtitle css-fs2d1k" style="opacity:0"><span style="opacity:1"></span></p></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">  transformForecast</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-plain">        </span><span class="token-function">transformForecast</span><span class="token-punctuation">(</span><span class="token-plain">forecast</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> transformedForecast</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div></div></code></pre><p class="cs-subtitle css-fs2d1k" style="opacity:1"><span style="opacity:1">callback &#x27;hell&#x27;</span></p></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">Promises &amp; Await</h1></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:row;justify-content:center;align-items:center;font-size:0.8em;position:relative" class="cs-col-layout"><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> callbacks </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;../services/weatherApi&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">  getLngLatFromIPAddr</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">  getCityFromLngLat</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">  getForecast</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">  transformForecast</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> callbacks</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">500</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">​</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherPromises</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherCallbacks</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> ipAddr </span><span class="token-operator">=</span><span class="token-plain"> req</span><span class="token-punctuation">.</span><span class="token-property-access">connection</span><span class="token-punctuation">.</span><span class="token-property-access">remoteAddress</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">  </span><span class="token-function">getLngLatFromIPAddr</span><span class="token-punctuation">(</span><span class="token-plain">ipAddr</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> lngLat</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">      </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-30"><span class="token-plain">    </span><span class="token-function">getCityFromLngLat</span><span class="token-punctuation">(</span><span class="token-plain">lngLat</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> city</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">      </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">        </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-33"><span class="token-plain">      </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-plain">      </span><span class="token-function">getForecast</span><span class="token-punctuation">(</span><span class="token-plain">city</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> forecast</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-35"><span class="token-plain">        </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-36"><span class="token-plain">          </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-37"><span class="token-plain">        </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-38"><span class="token-plain">        </span><span class="token-function">transformForecast</span><span class="token-punctuation">(</span><span class="token-plain">forecast</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> transformedForecast</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-39"><span class="token-plain">          </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-plain">            </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-41"><span class="token-plain">          </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-42"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-43"><span class="token-plain">          </span><span class="token-keyword">return</span><span class="token-plain"> res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">200</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-plain">transformedForecast</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-44"><span class="token-plain">        </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-45"><span class="token-plain">      </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-46"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-47"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-48"><span class="token-punctuation">}</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span style="opacity:1">Callbacks</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">  transformForecast</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherPromises</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">Promises</span></h4></div></div></div></div><div style="flex:1;overflow:hidden;height:100%"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> promises </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;../services/weatherApi&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">  getLngLatFromIPAddr</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">  getCityFromLngLat</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">  getForecast</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">  transformForecast</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> promises</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleError</span><span class="token-punctuation">(</span><span class="token-parameter">err</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">  res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">500</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-plain">err</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">​</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">async</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherAsyncAwait</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherPromises</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> ipAddr </span><span class="token-operator">=</span><span class="token-plain"> req</span><span class="token-punctuation">.</span><span class="token-property-access">connection</span><span class="token-punctuation">.</span><span class="token-property-access">remoteAddress</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">  </span><span class="token-function">getLngLatFromIPAddr</span><span class="token-punctuation">(</span><span class="token-plain">ipAddr</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">then</span><span class="token-punctuation">(</span><span class="token-plain">getCityFromLngLat</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">then</span><span class="token-punctuation">(</span><span class="token-plain">getForecast</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">then</span><span class="token-punctuation">(</span><span class="token-plain">transformForecast</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-30"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">then</span><span class="token-punctuation">(</span><span class="token-parameter">forecast</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">      res</span><span class="token-punctuation">.</span><span class="token-method">status</span><span class="token-punctuation">(</span><span class="token-number">200</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">json</span><span class="token-punctuation">(</span><span class="token-plain">forecast</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-33"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">catch</span><span class="token-punctuation">(</span><span class="token-plain">handleError</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-punctuation">}</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq"><span style="opacity:1">Promises</span></h4></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">  transformForecast</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-keyword">export</span><span class="token-plain"> </span><span class="token-keyword">default</span><span class="token-plain"> </span><span class="token-keyword">async</span><span class="token-plain"> </span><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">handleGetWeatherAsyncAwait</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">AsyncAwait</span></h4></div></div></div></div></div></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Fullstack Javascript</h2></div><div class="css-gxvojt"><h3 class="css-1djqpdg">Server Side Single Page Applications</h3><ul class="css-1uk1gs8"><li class="css-0">Node allows for hybrid web applications<ul class="css-1uk1gs8"><li class="css-0">Client side SPA&#x27;s can now be used on the server</li></ul></li><li class="css-0">Initial render is done on the server<ul class="css-1uk1gs8"><li class="css-0">HTML markup is sent to the client and rehydrated</li></ul></li><li class="css-0">This method works with any modern framework<ul class="css-1uk1gs8"><li class="css-0">React, Angular, Vue, etc.</li></ul></li></ul></div><div class="css-gxvojt"><h3 class="css-1djqpdg">SSR Architecture</h3><ul class="css-1uk1gs8"><li class="css-0">Do not build monolithic SSR applications</li><li class="css-0">SSR nodes should be treated as a service<ul class="css-1uk1gs8"><li class="css-0">&quot;Render as a service&quot;</li></ul></li><li class="css-0">Decouple your data to its own dedicated API service</li><li class="css-0">Data access should always be over http - <em class="css-0">even on the server</em></li></ul></div><div class="css-gxvojt"><h2 class="css-1djqpdg">SSR Demo</h2><style data-emotion-css="1gxdjd5">.css-1gxdjd5{font-family:"Roboto Mono",Menlo,monospace;padding:16px;}</style><pre class="css-1gxdjd5"><style data-emotion-css="vgof0f">.css-vgof0f{font-family:"Roboto Mono",Menlo,monospace;}</style><code class="css-vgof0f">goto &quot;3.0-express-api-server&quot;
goto &quot;3.1-ssr-react&quot;
</code></pre></div><div class="css-gxvojt"><h2 class="css-1djqpdg">Scaling Node</h2><p class="css-0">Clusters &amp; Threading</p></div><div class="css-gxvojt"><h3 class="css-1djqpdg">Clusters</h3><ul class="css-1uk1gs8"><li class="css-0">A cluster consists of forked node processes</li><li class="css-0">The pool of node workers share a single port</li><li class="css-0">The main proc distributes load using a round robin approach</li><li class="css-0">All applications should be designed to horizontally scale</li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">const</span><span class="token-plain"> cluster </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;cluster&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-keyword">const</span><span class="token-plain"> http </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;http&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-keyword">const</span><span class="token-plain"> numCPUs </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">require</span><span class="token-punctuation">(</span><span class="token-string">&quot;os&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-method">cpus</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">.</span><span class="token-property-access">length</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">cluster</span><span class="token-punctuation">.</span><span class="token-property-access">isMaster</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span><span class="token-string">Master </span><span class="token-interpolation-punctuation">${</span><span class="token-interpolation">process</span><span class="token-punctuation">.</span><span class="token-property-access">pid</span><span class="token-interpolation-punctuation">}</span><span class="token-string"> is running</span><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">  </span><span class="token-comment">// Fork workers.</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">  </span><span class="token-keyword">for</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-keyword">let</span><span class="token-plain"> i </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">;</span><span class="token-plain"> i </span><span class="token-operator">&lt;</span><span class="token-plain"> numCPUs</span><span class="token-punctuation">;</span><span class="token-plain"> i</span><span class="token-operator">++</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">    cluster</span><span class="token-punctuation">.</span><span class="token-method">fork</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-plain">  cluster</span><span class="token-punctuation">.</span><span class="token-method">on</span><span class="token-punctuation">(</span><span class="token-string">&quot;exit&quot;</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">worker</span><span class="token-punctuation">,</span><span class="token-parameter"> code</span><span class="token-punctuation">,</span><span class="token-parameter"> signal</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">    </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span><span class="token-string">worker </span><span class="token-interpolation-punctuation">${</span><span class="token-interpolation">worker</span><span class="token-punctuation">.</span><span class="token-property-access">process</span><span class="token-punctuation">.</span><span class="token-property-access">pid</span><span class="token-interpolation-punctuation">}</span><span class="token-string"> died</span><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">else</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">  </span><span class="token-comment">// Workers can share any TCP connection</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">  </span><span class="token-comment">// In this case it is an HTTP server</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">  http</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">createServer</span><span class="token-punctuation">(</span><span class="token-punctuation">(</span><span class="token-parameter">req</span><span class="token-punctuation">,</span><span class="token-parameter"> res</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-arrow">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">      res</span><span class="token-punctuation">.</span><span class="token-method">writeHead</span><span class="token-punctuation">(</span><span class="token-number">200</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">      res</span><span class="token-punctuation">.</span><span class="token-method">end</span><span class="token-punctuation">(</span><span class="token-string">&quot;hello world\n&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-method">listen</span><span class="token-punctuation">(</span><span class="token-number">8000</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-template-punctuation">`</span><span class="token-string">Worker </span><span class="token-interpolation-punctuation">${</span><span class="token-interpolation">process</span><span class="token-punctuation">.</span><span class="token-property-access">pid</span><span class="token-interpolation-punctuation">}</span><span class="token-string"> started</span><span class="token-template-punctuation">`</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-punctuation">}</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">cluster example</span></h4></div></div></div></div></div><div class="css-gxvojt"><h3 class="css-1djqpdg">Threading</h3><ul class="css-1uk1gs8"><li class="css-0">Similar to clusters with a more general API</li><li class="css-0">Useful for performing <em class="css-0">CPU</em> intensive operations</li><li class="css-0">Do not use for I/O operations<ul class="css-1uk1gs8"><li class="css-0">Instead stick with regular Asynchronous patterns</li></ul></li></ul></div><div class="css-gxvojt"><div style="width:100vw;max-width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center" class="cs-layout"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-oedec6" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-xbe36b" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">import</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-plain"> </span><span class="token-maybe-class-name">Worker</span><span class="token-punctuation">,</span><span class="token-plain"> isMainThread </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">from</span><span class="token-plain"> </span><span class="token-string">&quot;worker_threads&quot;</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">isMainThread</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">  </span><span class="token-comment">// This re-loads the current file inside a Worker instance.</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">  </span><span class="token-keyword">new</span><span class="token-plain"> </span><span class="token-class-name">Worker</span><span class="token-punctuation">(</span><span class="token-plain">__filename</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">else</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-string">&quot;Inside Worker!&quot;</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">  </span><span class="token-console">console</span><span class="token-punctuation">.</span><span class="token-method">log</span><span class="token-punctuation">(</span><span class="token-plain">isMainThread</span><span class="token-punctuation">)</span><span class="token-punctuation">;</span><span class="token-plain"> </span><span class="token-comment">// Prints &#x27;false&#x27;.</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-punctuation">}</span></div></div><div></div></code></pre><h4 class="cs-title css-1q54swq" style="opacity:1"><span style="opacity:1">threading example</span></h4></div></div></div></div></div><div class="css-gxvojt"><h1 class="css-1djqpdg">End</h1></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/print";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3fe65d65bb04262185f8.js"],"component---gatsby-theme-mdx-deck-src-templates-deck-js":["/component---gatsby-theme-mdx-deck-src-templates-deck-js-52381b3c74ef8f0a1d31.js"]};/*]]>*/</script><script src="/webpack-runtime-624e0cc4eb6b8a828713.js" async=""></script><script src="/app-3fe65d65bb04262185f8.js" async=""></script><script src="/commons-cb11f4ecc482359b7fd0.js" async=""></script><script src="/component---gatsby-theme-mdx-deck-src-templates-deck-js-52381b3c74ef8f0a1d31.js" async=""></script></body></html>